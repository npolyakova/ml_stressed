<!doctype html>
<html lang="ru">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Тренажер "Мастер ударений"</title>
		<!-- РАСПОЛОЖЕНИЕ КНОПОК (РЯДОМ) -->
		<script>
		button.near {
		float:right;
		margin-left:20px;
		}
		</script>
		<!-- СТИЛЬ КНОПОК -->
		<style>
				button.knopka {
				color: #8B4513;
				background: #DEB887;
				padding: 25px 50px;
				font-size: 25px;
				border-radius: 5px;
				border: 5px solid #8B4513;
				}
				button.knopka:hover {
				background: #BC8F8F;
				color: #6A5ACD;
				border: 7px solid #6A5ACD;
				}
		</style>
		<!-- СТИЛЬ ДЛЯ ВЫВОДА СЛОВ -->
		<style>
        body {
			display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh; /* Занять всю высоту окна */
            margin: 0; /* Убрать отступы по умолчанию */
        }
            #word {
            font-size: 2em; /* Увеличиваем размер шрифта для слова */
            margin-bottom: 20px; /* Отступ снизу */
        }
    </style>
		</head>
	

	<body style="background-color: #DEB887">
	<h1><center><p style="font-size:50px;color:#8B4513;font-family:arial">Мастер ударений</p></center></h1>
	<hr size="5" width="50%" color="#8B4513">
	<br>
	<br>
	<br>
	<h1 id="word" style="font-size:80px;color:#8B4513;font-family:arial"><center>красивее</center></h1>
	<br>
	<br>	
	<br>
	<center>
		<!-- КНОПКА ЗАПИСЬ -->
				<button id="startButton" class="near knopka">ЗАПИСЬ</button>
				
		
		<!-- КНОПКА СТОП -->
				<button id="stopButton" class="near knopka" disabled>СТОП</button>
		</center>	
	<!-- СКРИПТ ДЛЯ ПОЛУЧЕНИЯ СПИСКА СЛОВ С СЕРВЕРА-->	
	<script>
        let words = ['Привет', 'Пока'];

        // Функция для получения списка слов с сервера
        async function fetchWords() {
            try {
                const response = await fetch('https://example.com/api/words'); // Замените на ваш URL
                if (!response.ok) {
                    throw new Error('Сеть ответила с ошибкой');
                }
                words = await response.json();
            } catch (error) {
                console.error('Ошибка при получении слов:', error);
            }
        }

        // Функция для смены слова
        function changeWord() {
            if (words.length === 0) {
                alert('Список слов пуст. Пожалуйста, попробуйте позже.');
                return;
            }
            const randomIndex = Math.floor(Math.random() * words.length);
            document.getElementById('word').innerText = words[randomIndex];
        }

        // Обработчик события для кнопки
        document.getElementById('stopButton').addEventListener('click', changeWord);

        // Получаем слова при загрузке страницы
        window.onload = fetchWords;
    </script>
	<!-- СКРИПТ ДЛЯ ЗАПИСИ И ОТПРАВКИ НА СЕРВЕР-->	
	<script>
        let mediaRecorder;
        let audioChunks = [];
        let audioBlob;
        let audioStream;
		let isRecording = false; // Флаг для отслеживания запроса микрофона

        document.getElementById('startButton').onclick = async () => {
            // Запрашиваем доступ к микрофону
			audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(audioStream);
			

            mediaRecorder.ondataavailable = event => {
                audioChunks.push(event.data);
            };

            mediaRecorder.onstop = () => {
                audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                audioChunks = []; // Очистка массива для следующей записи
                console.log('Аудио записано:', audioBlob);
            };

            mediaRecorder.start();
            document.getElementById('startButton').disabled = true;
            document.getElementById('stopButton').disabled = false;
        };

        document.getElementById('stopButton').onclick = () => {
            mediaRecorder.stop();
            
            // Отключаем микрофон
            audioStream.getTracks().forEach(track => track.stop());
            
            document.getElementById('startButton').disabled = false;
            document.getElementById('stopButton').disabled = true;

            // Здесь вы можете отправить audioBlob на сервер
            // Например, используя fetch:
            /*
            const formData = new FormData();
            formData.append('audio', audioBlob, 'recording.wav');

            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error('Ошибка:', error));
            */
        };
    </script>

	</body>
</html>