<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тренажер "Мастер ударений"</title>
    
    <style>
        button.near {
            float: left;
            margin-left: 20px;
        }
        button.knopka {
            color: #8B4513;
            background: #DEB887;
            padding: 25px 50px;
            font-size: 25px;
            border-radius: 5px;
            border: 5px solid #8B4513;
        }
        button.knopka:hover {
            background: #BC8F8F;
            color: #6A5ACD;
            border: 5px solid #6A5ACD;
        }
        button.knopka:disabled {
            border: 5px solid #C0C0C0;
        }
       body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #DEB887;
        }
        #word {
            font-size: 2em; 
            margin-bottom: 20px; 
        }
        #scores1 {
            font-size: 80px;
            color: #8B4513;
            font-family: arial;
            text-align: center; 
        }
    </style>
</head>
	

<body style="background-color: #DEB887">
    <h1><p style="font-size:50px;color:#8B4513;font-family:arial;text-align:center">Мастер ударений</p></h1>
    <hr size="5" width="50%" color="#8B4513">

    <br>
    <p id="scores1">1/20</p>
    <h1 id="word" style="font-size:80px;color:#8B4513;font-family:arial;text-align:center">красивее</h1>
    <br><br><br>

    <center>
        <!-- КНОПКА ЗАПИСЬ -->
        <button id="startButton" class="near knopka">ЗАПИСЬ</button>

        <!-- КНОПКА СТОП -->
        <button id="stopButton" class="near knopka" disabled>СТОП</button>
    </center>

	<!-- СКРИПТ ДЛЯ ПОЛУЧЕНИЯ СПИСКА СЛОВ С СЕРВЕРА-->	
	<script>
        let words = [];

        // Функция для получения списка слов с сервера
        async function fetchWords() {
            try {
                const response = await fetch('https://example.com/api/words'); // Заменить на наш URL
                if (!response.ok) {
                    throw new Error('Сеть ответила с ошибкой');
                }
                words = await response.json();
            } catch (error) {
                console.error('Ошибка при получении слов:', error);
            }
        }

        // Функция для смены слова
        function changeWord() {
            if (words.length === 0) {
                alert('Список слов пуст. Пожалуйста, попробуйте позже.');
                return;
            }
            const randomIndex = Math.floor(Math.random() * words.length);
            document.getElementById('word').innerText = words[randomIndex];
        }

        // Обработчик события для кнопки
        document.getElementById('stopButton').addEventListener('click', changeWord);

        // Получаем слова при загрузке страницы
        window.onload = fetchWords;
    	
		//СКРИПТ ДЛЯ СЧЕТЧИКА
    
        let currentScore = 1; // Начальное значение счетчика
        words = ["красивее", "умнее", "выше", "ниже", "смешнее", "ярче", "грустнее", "дальше", "ближе", "толще", "тоньше", "дольше", "короче", "тише", "громче", "светлее", "темнее", "теплее", "холоднее", "сильнее"]; // Массив слов

		let mediaRecorder;
        let audioChunks = [];
        let audioBlob;
        let audioStream;
		let isRecording = false; // Флаг для отслеживания запроса микрофона
		
        document.getElementById("stopButton").onclick = function() {
		
			mediaRecorder.stop();
            
            // Отключаем микрофон
            audioStream.getTracks().forEach(track => track.stop());
            
            document.getElementById('startButton').disabled = false;
            document.getElementById('stopButton').disabled = true;

            // Здесь вы можете отправить audioBlob на сервер
            // Например, используя fetch:
            /*
            const formData = new FormData();
            formData.append('audio', audioBlob, 'recording.wav');

            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error('Ошибка:', error));
            */
		
            if (currentScore <= 20) {
                currentScore++; // Увеличиваем счетчик
				document.getElementById("scores1").innerText = currentScore + "/20"; // Обновляем текст счетчика
				console.log(currentScore)
                if (currentScore > 20) {
                    this.disabled = true; // Отключаем кнопку "СТОП" после достижения 20
                }
                updateWord(); // Обновляем слово
            }
        };

        document.getElementById("startButton").onclick = async() => {
			 // Запрашиваем доступ к микрофону
			audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(audioStream);
			

            mediaRecorder.ondataavailable = event => {
                audioChunks.push(event.data);
            };

            mediaRecorder.onstop = () => {
                audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                audioChunks = []; // Очистка массива для следующей записи
                console.log('Аудио записано:', audioBlob);
            };

            mediaRecorder.start();
            document.getElementById('startButton').disabled = true;
			
            document.getElementById("stopButton").disabled = false; // Включаем кнопку "СТОП"
			if (currentScore > 20) {
				currentScore = 1; // Сбрасываем счетчик
			}
        };

        function updateWord() {
            if (currentScore <= words.length) {
                document.getElementById("word").innerText = words[currentScore - 1]; // Обновляем слово по текущему счетчику
            } else {
                document.getElementById("word").innerText = "Игра окончена!"; // Сообщение об окончании игры
            }
        }
	
	// СКРИПТ ДЛЯ ЗАПИСИ И ОТПРАВКИ НА СЕРВЕР	
        

    </script>

	</body>
</html>
